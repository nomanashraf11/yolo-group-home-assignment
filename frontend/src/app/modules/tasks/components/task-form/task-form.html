<div class="task-form-container">
  <div class="form-header">
    <h2>{{ isEditMode ? 'Edit Task' : 'Create New Task' }}</h2>
    <button class="close-btn" (click)="onCancel()">
      <svg
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M18 6L6 18M6 6L18 18"
          stroke="#64748B"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
    </button>
  </div>

  <form [formGroup]="taskForm" class="form-content">
    <app-input-field
      label="Title"
      placeholder="Enter task title"
      icon="title"
      [formControl]="title"
      [required]="true"
      [maxLength]="100"
    >
      <div
        *ngIf="title?.invalid && (title?.dirty || title?.touched)"
        class="error-message"
      >
        <span *ngIf="title?.errors?.['required']">Title is required</span>
        <span *ngIf="title?.errors?.['maxlength']"
          >Must be less than 100 characters</span
        >
      </div>
      <div class="character-count">{{ title?.value?.length || 0 }}/100</div>
    </app-input-field>

    <app-input-field
      label="Description"
      placeholder="Enter task description"
      icon="description"
      [formControl]="description"
      [textarea]="true"
      [rows]="4"
      [maxLength]="500"
    >
      <div
        *ngIf="description?.invalid && (description?.dirty || description?.touched)"
        class="error-message"
      >
        <span *ngIf="description?.errors?.['maxlength']"
          >Must be less than 500 characters</span
        >
      </div>
      <div class="character-count">
        {{ description?.value?.length || 0 }}/500
      </div>
    </app-input-field>

    <div class="form-row">
      <mat-form-field>
        <mat-label>Due Date</mat-label>
        <input
          matInput
          [matDatepicker]="picker"
          [formControl]="dueDate"
          [min]="minDate"
          required
        />
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
        <mat-error
          *ngIf="dueDate?.invalid && (dueDate?.dirty || dueDate?.touched)"
        >
          <span *ngIf="dueDate?.errors?.['required']"
            >Due date is required</span
          >
        </mat-error>
      </mat-form-field>
    </div>
    <div class="form-row">
      <app-select
        label="Status"
        [options]="statusOptions"
        [required]="true"
        [formControl]="status"
      >
        <ng-template #optionTemplate let-option>
          <span class="status-badge {{option.value | lowercase}}">
            {{option.label}}
          </span>
        </ng-template>
        <div
          *ngIf="status?.invalid && (status?.dirty || status?.touched)"
          class="error-message"
        >
          <span *ngIf="status?.errors?.['required']">Status is required</span>
        </div>
      </app-select>
    </div>

    <!-- <app-select
      label="Category"
      [options]="categoryOptions"
      placeholder="Select a category"
    >
      <ng-template #optionTemplate let-option>
        <div class="category-option">
          <span class="category-dot" [style.background]="option.color"></span>
          {{option.label}}
        </div>
      </ng-template>
    </app-select> -->
  </form>

  <div class="form-actions">
    <app-button type="secondary" size="medium" (click)="onCancel()">
      Cancel
    </app-button>
    <app-button
      type="primary"
      size="medium"
      [disabled]="taskForm.invalid"
      (click)="onSubmit()"
    >
      {{ isEditMode ? 'Update Task' : 'Create Task' }}
    </app-button>
  </div>
</div>
